<!-- /dist/index.html -->
<!doctype html>
<html>

<head>
   <title>react</title>
   <script src="./react.js"></script>
   <script src="./react-dom/react-dom.js"></script>
   <style>
      .classA {
         color: red;
      }

      .classA .classB {
         color: blue;
      }
   </style>
</head>

<body>
   <div id="root">
      <div></div>
   </div>
   <script>
      console.log("React", React);
      console.log("ReactDOM", ReactDOM);
      var strReactElement = React.createElement('div', {
         children: '888',
         componentDidMount: function () {
            // 这玩意不会被执行，不是生命周期，会提示Warning, 
            // 只有React.createElement(fn:function, {});的react元素才有生命周期
         }
      })

      var Son2 = (function (Component) {
         /*
         Component.prototype如下

         isMounted: (...)
         replaceState: (...)
         isReactComponent: {}
         setState: ƒ (partialState, callback)
         forceUpdate: ƒ (callback)
         constructor: ƒ Component(props, context, updater)
         get isMounted: ƒ ()
         get replaceState: ƒ ()
         
         */

         Mod.prototype = Object.create(Component.prototype);
         Mod.prototype.constructor = Mod;
         Mod.__proto__ = Component;

         function Mod(props) {
            var _this;
            _this = Component.call(this, props) || this;
            _this.state = {
               name: 'CC'
            };

            _this.componentDidCatch = function (error, info) {
               // 当自身发生异常时，是不会执行此声明周期的
               console.log('Son2 componentDidCatch', arguments)
            }

            return _this;
         }

         Mod.prototype.render = function () {


            const self = this;
            console.log(self.state.name);

            if (self.state.name !== 'CC') {
               a.a = 1;
            }

            return React.createElement(
               'div',
               {
                  children: "CC",
                  key: 'Parent',
                  id: 'Parent',
                  onClick: () => {
                     self.setState({
                        name: 'Parent',
                     })
                  }
               }
            );
         }
         return Mod;
      }(React.Component))


      var Parent = (function (Component) {

         Mod.prototype = Object.create(Component.prototype);
         Mod.prototype.constructor = Mod;
         Mod.__proto__ = Component;

         function Mod(props) {
            var _this;
            _this = Component.call(this, props) || this;
            _this.state = {
               name: 'TestMod',
               errorFlag: false,
            };

            _this.componentDidMount = function () {
               // 没参数
               console.log('componentDidMount', arguments)
            }

            _this.shouldComponentUpdate = function () {
               // 接受两个参数nextProps,nextState
               console.log('shouldComponentUpdate', arguments)
               return true;
            }

            _this.getSnapshotBeforeUpdate = function () {
               // 接受2个参数，return的值作为componentDidUpdate的第三个参数
               console.log('getSnapShotBeforeUpdate', arguments)
               return { a: 1 };
            }

            _this.componentDidUpdate = function () {
               // 接受3个参数，prevProps，prevState
               console.log('componentDidUpdate', arguments)
            }

            _this.componentDidCatch = function (error, info) {
               // 子组件的render发生异常，才会被执行的生命周期
               console.log('Parent componentDidCatch', arguments)
               _this.setState({
                  errorFlag: true,
               })
            }

            return _this;
         }

         var count = 0;

         Mod.getDerivedStateFromProps = function () {
            if (count === 0) {
               console.log('初始化 getDerivedStateFromProps')
            } else {
               console.log('变更期 getDerivedStateFromProps')
            }
            return null;
         }

         Mod.prototype.render = function () {




            if (count === 0) {
               console.log("初始化 render")
               count = 1;
            } else {
               console.log("变更起 render")
            }

            const self = this;
            var errorFlag = this.state.errorFlag;


            return React.createElement(
               'div',
               {
                  children: errorFlag ? "发生了错误" : [self.state.name, strReactElement, React.createElement(Son2, null)],
                  key: 'Parent',
                  id: 'Parent',
                  onClick: () => {
                     debugger;
                     self.setState({
                        name: 'Parent',
                     })
                  }
               }
            );
         }
         return Mod;
      }(React.Component))
      var reactElement = React.createElement(Parent, null);

      var DIVSonD = React.createElement("span", { className: 'classD' }, "这里是一个span", reactElement);
      var DivSon = React.createElement("div", { className: 'classB', onClick: function () { alert("点击事件哦") } }, "777", DIVSonD);
      var DivSonA = React.createElement("span", { className: 'classC' }, "这里是一个span");
      var fnReactElement = React.createElement(function(){
         var state = React.useState("fnReactElement");
         return React.createElement('div', {
            onClick: function(){
               state[1]("999")
            }
         }, state[0]);
      });
      // props.children
      // ref的使用
      // setState如何触发
      var Div = React.createElement("div", { className: 'classA' }, fnReactElement, DivSon, 999, DivSonA);
      // 6 5 5 6 5 5 3
      ReactDOM.render(Div, document.getElementById('root'));
   </script>
</body>

</html>